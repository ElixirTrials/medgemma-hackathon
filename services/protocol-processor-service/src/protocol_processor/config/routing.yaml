# Entity type → API mapping for terminology grounding via ToolUniverse
#
# routing_rules: maps entity type names to a list of API names to query.
# Use `skip: true` for entity types that should not be grounded.
#
# api_configs: defines how each API is accessed.
# - source: "tooluniverse" uses the ToolUniverse SDK (all systems)
# - tool_name: the ToolUniverse tool identifier for this system
#
# Note: Demographic entities are NOT skipped — age/gender grounding is attempted
# via UMLS/SNOMED. The MedGemma agentic reasoning loop handles derived entity
# mapping (age → birthDate concept) before retry attempts.
#
# Note: Consent entities ARE skipped — consent/participation criteria are not
# groundable to medical terminology codes.

routing_rules:
  Medication:
    - rxnorm   # Specific drug names; drug class terms (e.g., "ACE inhibitor") may return no RXCUI
    - umls     # Fallback for drug classes and broader medication concepts

  Condition:
    - icd10
    - snomed
    - umls

  Lab_Value:
    - loinc
    - umls

  Biomarker:
    - hpo
    - umls

  Procedure:
    - umls
    - snomed

  Phenotype:
    - hpo
    - umls

  Demographic:
    - umls
    - snomed

  Consent:
    skip: true  # Consent/participation criteria not groundable to terminology

  # Non-groundable catch-all entities (e.g., ASA physical status, non-medical criteria).
  # Empty list means no terminology APIs configured — entity gets expert_review routing.
  Other: []

api_configs:
  rxnorm:
    source: tooluniverse
    tool_name: RxNorm_get_drug_names

  icd10:
    source: tooluniverse
    tool_name: ICD10_search_codes

  loinc:
    source: tooluniverse
    tool_name: LOINC_search_tests

  hpo:
    source: tooluniverse
    tool_name: HPO_search_terms

  umls:
    source: tooluniverse
    tool_name: umls_search_concepts

  snomed:
    source: tooluniverse
    tool_name: snomed_search_concepts
