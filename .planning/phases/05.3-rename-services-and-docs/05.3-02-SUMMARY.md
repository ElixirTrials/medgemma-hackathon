---
phase: "05.3"
plan: "02"
subsystem: "infrastructure"
tags: ["refactor", "rename", "documentation"]
dependency-graph:
  requires: ["05.3-01"]
  provides: ["grounding-service-renamed"]
  affects: ["api-service", "grounding-service", "infra", "ci"]
tech-stack:
  added: []
  patterns: ["git-mv-for-history-preservation"]
key-files:
  created: []
  modified:
    - "services/grounding-service/pyproject.toml"
    - "services/grounding-service/src/grounding_service/**/*.py"
    - "services/grounding-service/tests/test_grounding_graph.py"
    - "services/grounding-service/mkdocs.yml"
    - "services/grounding-service/docs/api/index.md"
    - "services/grounding-service/README.md"
    - "services/api-service/src/api_service/main.py"
    - "services/api-service/pyproject.toml"
    - "services/api-service/tests/test_schemas.py"
    - "services/api-service/tests/test_umls_clients.py"
    - "pyproject.toml"
    - "infra/docker-compose.yml"
    - "scripts/check-all.sh"
    - ".github/workflows/ci.yml"
    - "mkdocs.yml"
decisions:
  - "Used git mv to preserve git history during directory rename"
  - "Renamed Docker service from agent-b to grounding for alignment"
  - "Updated all imports and references atomically across services"
metrics:
  duration: "7 minutes"
  completed: "2026-02-11"
---

# Phase 5.3 Plan 02: Rename agent-b-service to grounding-service Summary

**One-liner:** Renamed agent-b-service to grounding-service across codebase (directory, package, imports, infra, docs) using git mv for history preservation.

## Overview

This plan systematically renamed agent-b-service to grounding-service to align the codebase with the actual implementation (entity grounding via MedGemma + UMLS). The rename covered the service directory, Python package name, all internal imports, cross-service references, infrastructure configs, CI/CD, and documentation.

## Tasks Completed

### 1. Rename directory and Python package (Commit: 776dfaa)

- Renamed `services/agent-b-service/` → `services/grounding-service/` using `git mv`
- Renamed `services/grounding-service/src/agent_b_service/` → `services/grounding-service/src/grounding_service/` using `git mv`
- Updated `pyproject.toml`:
  - `name = "grounding-service"`
  - `packages = ["src/grounding_service"]`
  - `addopts = "--cov=grounding_service ..."`

**Files changed:** 19 files (directory and package renames, pyproject.toml)

### 2. Update internal imports (grounding-service) (Commit: 13760d3)

Updated all imports from `agent_b_service` to `grounding_service` in:

- `nodes/validate_confidence.py` - state and umls_client imports
- `nodes/map_to_snomed.py` - state and umls_client imports
- `nodes/ground_to_umls.py` - state import
- `nodes/extract_entities.py` - schemas and state imports
- `schemas/__init__.py` - entities import
- `trigger.py` - graph import

**Files changed:** 6 files

### 3. Update api-service references (Commit: 2ebf245)

- Updated `main.py`: `from grounding_service.trigger import handle_criteria_extracted`
- Updated `pyproject.toml`: pythonpath from `../agent-b-service/src` to `../grounding-service/src`
- Updated test imports in:
  - `test_schemas.py` - entities schemas import
  - `test_umls_clients.py` - all agent_b_service references to grounding_service (docstrings, imports, patches)

**Files changed:** 4 files

### 4. Update root and infra (Commit: 1ade57e)

**Root `pyproject.toml`:**
- Workspace member: `services/grounding-service`
- Mypy overrides: `grounding_service`, `grounding_service.*`
- Test pythonpath and coverage source: `services/grounding-service/src`

**Infra and CI:**
- `infra/docker-compose.yml`: renamed service `agent-b` → `grounding` with updated dockerfile path
- `scripts/check-all.sh`: updated mypy paths
- `.github/workflows/ci.yml`: updated mypy type check paths
- `mkdocs.yml`: navigation entry `grounding-service` with updated include path

**Files changed:** 5 files

### 5. Update grounding-service docs and README (Commit: be3d978)

- `mkdocs.yml`: `site_name: grounding-service`
- `docs/api/index.md`: "API Reference for grounding-service"
- `README.md`: Complete rewrite describing entity grounding workflow with MedGemma and UMLS MCP, updated all code examples

**Files changed:** 3 files

### 6. Fix test imports (Commit: 085da0f)

- Updated `tests/test_grounding_graph.py`: import from `grounding_service.graph`
- Updated docstring to reference grounding-service

**Files changed:** 1 file (new file created by git mv)

## Verification

**Tests passed:**
- ✅ `uv run pytest services/grounding-service/tests/ -v` - 5/5 passed (32% coverage on graph compilation)
- ✅ `uv run pytest services/api-service/tests/test_schemas.py -v` - 29/29 passed (confirms import rename worked)

**Mypy type check:**
- ✅ `uv run mypy services/grounding-service/src services/api-service/src` - No new errors (6 pre-existing missing stub warnings)

**Remaining references:** Only in documentation files (PROJECT_OVERVIEW.md, Makefile, docs/\*.md) - these will be addressed in plan 05.3-03.

## Deviations from Plan

### Auto-fixed Issues

**1. [Rule 3 - Blocking Issue] Added test file to repository**
- **Found during:** Task 6 (verification)
- **Issue:** `test_grounding_graph.py` existed but wasn't tracked by git after the `git mv` rename
- **Fix:** Added test file with updated import to repository
- **Files modified:** `services/grounding-service/tests/test_grounding_graph.py`
- **Commit:** 085da0f

No other deviations - plan executed exactly as written.

## Impact Summary

**Services affected:**
- grounding-service (fully renamed)
- api-service (imports updated)

**Infrastructure affected:**
- Docker Compose (service renamed)
- CI/CD workflows (type check paths)
- Root workspace config
- Documentation navigation

**No functional changes** - purely a rename operation. All imports updated atomically to prevent breakage.

## Next Steps

Plan 05.3-03 will:
- Update documentation files (PROJECT_OVERVIEW.md, docs/\*.md)
- Update Makefile references
- Ensure all narrative documentation reflects new service names

## Self-Check: PASSED

**Created files:**
- ✅ `.planning/phases/05.3-rename-services-and-docs/05.3-02-SUMMARY.md` (this file)

**Commits exist:**
- ✅ 776dfaa - refactor(05.3-02): rename agent-b-service directory and package to grounding-service
- ✅ 13760d3 - refactor(05.3-02): update internal imports in grounding-service
- ✅ 2ebf245 - refactor(05.3-02): update api-service references to grounding-service
- ✅ 1ade57e - refactor(05.3-02): update root and infra references to grounding-service
- ✅ be3d978 - refactor(05.3-02): update grounding-service documentation
- ✅ 085da0f - fix(05.3-02): update test imports from agent_b_service to grounding_service

**Verification:**
```bash
# All commits verified
git log --oneline | grep "05.3-02"
776dfaa refactor(05.3-02): rename agent-b-service directory and package to grounding-service
13760d3 refactor(05.3-02): update internal imports in grounding-service
2ebf245 refactor(05.3-02): update api-service references to grounding-service
1ade57e refactor(05.3-02): update root and infra references to grounding-service
be3d978 refactor(05.3-02): update grounding-service documentation
085da0f fix(05.3-02): update test imports from agent_b_service to grounding_service

# Files exist
[ -f "services/grounding-service/pyproject.toml" ] && echo "FOUND"
FOUND
```
