---
phase: 21-gemini-3-flash-upgrade
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - services/extraction-service/src/extraction_service/nodes/extract.py
  - services/extraction-service/src/extraction_service/nodes/queue.py
  - services/extraction-service/scripts/verify_extraction.py
  - services/grounding-service/src/grounding_service/nodes/extract_entities.py
  - .env.example
autonomous: true

must_haves:
  truths:
    - "All hardcoded gemini-2.5-flash defaults are replaced with gemini-3-flash-preview"
    - ".env.example documents GEMINI_MODEL_NAME=gemini-3-flash-preview"
    - "ruff check passes on all modified files"
  artifacts:
    - path: "services/extraction-service/src/extraction_service/nodes/extract.py"
      provides: "Extract node using gemini-3-flash-preview default"
      contains: "gemini-3-flash-preview"
    - path: "services/extraction-service/src/extraction_service/nodes/queue.py"
      provides: "Queue node recording gemini-3-flash-preview as extraction_model"
      contains: "gemini-3-flash-preview"
---

<objective>
Update all Gemini model references from gemini-2.5-flash to gemini-3-flash-preview.

Purpose: Upgrade the criteria extraction model for improved extraction quality.
Output: All 4 Python files and .env.example use gemini-3-flash-preview as the default model.
</objective>

<tasks>

<task type="auto">
  <name>Task 1: Update all gemini-2.5-flash references to gemini-3-flash-preview</name>
  <files>
services/extraction-service/src/extraction_service/nodes/extract.py
services/extraction-service/src/extraction_service/nodes/queue.py
services/extraction-service/scripts/verify_extraction.py
services/grounding-service/src/grounding_service/nodes/extract_entities.py
.env.example
  </files>
  <action>
Replace all instances of `gemini-2.5-flash` with `gemini-3-flash-preview` in:
1. `extract.py` line 89: `os.getenv("GEMINI_MODEL_NAME", "gemini-2.5-flash")`
2. `queue.py` line 48: `os.getenv("GEMINI_MODEL_NAME", "gemini-2.5-flash")`
3. `verify_extraction.py` line 60: `os.getenv("GEMINI_MODEL_NAME", "gemini-2.5-flash")`
4. `extract_entities.py` line 79: `return "gemini-2.5-flash"`

Add `GEMINI_MODEL_NAME=gemini-3-flash-preview` to `.env.example` in the Vertex AI section.
  </action>
  <verify>
1. Run `grep -r "gemini-2.5-flash" services/ .env.example` — should return NO matches
2. Run `grep -r "gemini-3-flash-preview" services/ .env.example` — should return 4+ matches
3. Run `uv run ruff check services/extraction-service/src/extraction_service/nodes/extract.py services/extraction-service/src/extraction_service/nodes/queue.py services/grounding-service/src/grounding_service/nodes/extract_entities.py`
  </verify>
  <done>All Gemini model references updated to gemini-3-flash-preview.</done>
</task>

</tasks>

<verification>
1. No remaining references to gemini-2.5-flash in Python files
2. .env.example has GEMINI_MODEL_NAME=gemini-3-flash-preview
3. ruff check passes
</verification>

<success_criteria>
- All hardcoded gemini-2.5-flash defaults replaced with gemini-3-flash-preview
- .env.example documents the new model name
- ruff check passes
</success_criteria>

<output>
After completion, create `.planning/phases/21-gemini-3-flash-upgrade/21-01-SUMMARY.md`
</output>
