{"role":"user","message":{"content":[{"type":"text","text":"<user_query>\n@services/protocol-processor-service/src/protocol_processor/prompts/grounding_evaluate.jinja2 @services/protocol-processor-service/src/protocol_processor/prompts/grounding_reasoning.jinja2 @services/protocol-processor-service/src/protocol_processor/prompts/grounding_system.jinja2 @services/protocol-processor-service/src/protocol_processor/prompts/system.jinja2 @services/protocol-processor-service/src/protocol_processor/prompts/user.jinja2 \n\nCan you combine these jinja prompts into a markdown file formatted like a yaml. The fields should be the name of the prompt, an explanation of where it is used in the code, where injected values (variables/parameters) come from, and the raw text.\n</user_query>"}]}}
{"role":"assistant","message":{"content":[{"type":"text","text":"Reading the prompt files and locating where each is used in the codebase."}]}}
{"role":"assistant","message":{"content":[{"type":"text","text":"Inspecting how each prompt is rendered and which variables are passed:"}]}}
{"role":"assistant","message":{"content":[{"type":"text","text":"Checking `_render_template` and `render_prompts` to trace variable flow:"}]}}
{"role":"assistant","message":{"content":[{"type":"text","text":"Creating the combined markdown file:"}]}}
{"role":"assistant","message":{"content":[{"type":"text","text":"Fixing a small typo in the doc."}]}}
{"role":"assistant","message":{"content":[{"type":"text","text":"Summary of what was added:\n\n**File created:** `services/protocol-processor-service/src/protocol_processor/prompts/PROMPTS.md`\n\nIt’s a single Markdown doc with one YAML-style block per prompt. Each block has:\n\n- **name** – Template filename (e.g. `grounding_evaluate.jinja2`).\n- **used_in** – Where the template is used:\n  - **grounding_system.jinja2** – System message in `medgemma_decider.py` for both `medgemma_decide()` (with `grounding_evaluate.jinja2`) and `agentic_reasoning_loop()` (with `grounding_reasoning.jinja2`).\n  - **grounding_evaluate.jinja2** – User message in `medgemma_decide()` when choosing the best terminology match from candidates.\n  - **grounding_reasoning.jinja2** – User message in `agentic_reasoning_loop()` for the 3-question retry strategy when initial grounding fails.\n  - **system.jinja2** – Gemini system instruction in `gemini_extractor.extract_criteria_structured()` (via `render_prompts()`).\n  - **user.jinja2** – Gemini user prompt in the same flow; only template that uses `title`.\n- **injected_values** – For each variable: where it comes from (e.g. `entity.get(\"text\")`, function args, `prompt_vars[\"title\"]`). `grounding_system.jinja2` and `system.jinja2` are noted as having no variables.\n- **raw_text** – Full template content in a YAML `|` block so Jinja2 syntax (e.g. `{{ ... }}`, `{% for %}`) is preserved.\n\nThe doc is in the same directory as the Jinja2 templates so it stays easy to find and update when prompts or call sites change."}]}}